–û–∂–∏–¥–∞–Ω–∏–µ `WalSenderWaitForWAL` –Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏ `START_REPLICATION SLOT` —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —Ç–æ, —á—Ç–æ –ø—Ä–æ—Ü–µ—Å—Å —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ (walsender) **–æ–∂–∏–¥–∞–µ—Ç –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö WAL-–∑–∞–ø–∏—Å–µ–π** –æ—Ç –æ—Å–Ω–æ–≤–Ω–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ä–µ–ø–ª–∏–∫–µ.

## –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ —ç—Ç–æ—Ç –º–æ–º–µ–Ω—Ç:

1. **–†–µ–ø–ª–∏–∫–∞ –ø–æ–¥–∫–ª—é—á–∏–ª–∞—Å—å** –∏ –∑–∞–ø—Ä–æ—Å–∏–ª–∞ –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ `START_REPLICATION SLOT`
2. **WALSender –ø—Ä–æ—Ü–µ—Å—Å** –≥–æ—Ç–æ–≤ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å WAL-–∑–∞–ø–∏—Å–∏
3. **–ù–æ –Ω–æ–≤—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –Ω–µ—Ç** - –æ—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–µ—Ä "–º–æ–ª—á–∏—Ç"
4. **–ü—Ä–æ—Ü–µ—Å—Å –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è** –≤ –æ–∂–∏–¥–∞–Ω–∏–∏ –Ω–æ–≤—ã—Ö WAL-–∑–∞–ø–∏—Å–µ–π

## –¢–∏–ø–∏—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:

### üîπ –ù–æ—Ä–º–∞–ª—å–Ω–∞—è —Å–∏—Ç—É–∞—Ü–∏—è:
```sql
-- –ù–∞ —Ä–µ–ø–ª–∏–∫–µ:
START_REPLICATION SLOT my_slot LOGICAL 0/0;
-- WALSender –∂–¥–µ—Ç –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏
```

### üîπ –ü—Ä–æ–±–ª–µ–º–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:

**1. –†–µ–ø–ª–∏–∫–∞ –æ—Ç—Å—Ç–∞–ª–∞ –∏ –∂–¥–µ—Ç —Å—Ç–∞—Ä—ã—Ö WAL:**
```sql
-- –ï—Å–ª–∏ —Ä–µ–ø–ª–∏–∫–∞ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç WAL, –∫–æ—Ç–æ—Ä—ã–π —É–∂–µ —É–¥–∞–ª–µ–Ω
START_REPLICATION SLOT my_slot LOGICAL 0/12345678;
-- WALSender –Ω–µ –º–æ–∂–µ—Ç –Ω–∞–π—Ç–∏ —Ç—Ä–µ–±—É–µ–º—ã–π WAL-—Ñ–∞–π–ª
```

**2. –°–ª–æ—Ç —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ "–∑–∞–≤–∏—Å":**
```sql
-- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–ª–æ—Ç—ã —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏
SELECT slot_name, active, restart_lsn, confirmed_flush_lsn 
FROM pg_replication_slots;
```

## –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:

```sql
-- 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–ª–æ—Ç–æ–≤ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏
SELECT slot_name, slot_type, active, 
       restart_lsn, confirmed_flush_lsn,
       pg_size_pretty(pg_wal_lsn_diff(pg_current_wal_lsn(), restart_lsn)) as lag_size
FROM pg_replication_slots;

-- 2. –ù–∞–π–¥–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å—ã WALSender
SELECT pid, application_name, state, sync_state,
       write_lag, flush_lag, replay_lag
FROM pg_stat_replication;

-- 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ WAL-–∞—Ä—Ö–∏–≤—ã
SELECT name, setting FROM pg_settings 
WHERE name LIKE '%wal%' OR name LIKE '%archive%';
```

## –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º:

### üîß –ï—Å–ª–∏ —Ä–µ–ø–ª–∏–∫–∞ –æ—Ç—Å—Ç–∞–ª–∞:
```sql
-- –ù–∞ –æ—Å–Ω–æ–≤–Ω–æ–π –±–∞–∑–µ - –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Å–æ–∑–¥–∞—Ç—å WAL-—Å–µ–≥–º–µ–Ω—Ç
SELECT pg_switch_wal();

-- –ò–ª–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ª—é–±—É—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
INSERT INTO test_table VALUES (1);
DELETE FROM test_table WHERE id = 1;
```

### üîß –ï—Å–ª–∏ —Å–ª–æ—Ç "–∑–∞–≤–∏—Å":
```sql
-- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ —Ä–µ–ø–ª–∏–∫–∏
-- –ò–ª–∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å —Å–ª–æ—Ç (–µ—Å–ª–∏ —ç—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ)
SELECT pg_drop_replication_slot('problem_slot');
SELECT pg_create_physical_replication_slot('problem_slot');
```

### üîß –ï—Å–ª–∏ WAL-—Ñ–∞–π–ª—ã —É–¥–∞–ª–µ–Ω—ã:
```bash
# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∏–∑ –∞—Ä—Ö–∏–≤–∞ –∏–ª–∏ –ø–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Ä–µ–ø–ª–∏–∫—É
pg_basebackup -h primary -D /path/to/replica -U replicator -P -R
```

## –ü—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∞:

```sql
-- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—Ç—Å—Ç–∞–≤–∞–Ω–∏—è —Ä–µ–ø–ª–∏–∫–∏
SELECT application_name, 
       pg_size_pretty(pg_wal_lsn_diff(pg_current_wal_lsn(), replay_lsn)) as replica_lag
FROM pg_stat_replication;

-- –†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Å–ª–æ—Ç—ã
SELECT slot_name, active, xmin, catalog_xmin
FROM pg_replication_slots 
WHERE NOT active;
```

**–í—ã–≤–æ–¥:** `WalSenderWaitForWAL` –æ–±—ã—á–Ω–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, –Ω–æ –≤ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –Ω–µ—Ç –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏. –ë–µ—Å–ø–æ–∫–æ–∏—Ç—å—Å—è —Å—Ç–æ–∏—Ç, –µ—Å–ª–∏ —ç—Ç–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –¥–æ–ª–≥–æ –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–π –∑–∞–ø–∏—Å–∏ –Ω–∞ –æ—Å–Ω–æ–≤–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ –∏–ª–∏ –µ—Å–ª–∏ –ø–æ—è–≤–ª—è—é—Ç—Å—è –æ—à–∏–±–∫–∏ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏.
