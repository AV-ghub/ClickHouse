
### üóëÔ∏è –†–∞–∑–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏: SQL –ø—Ä–æ—Ç–∏–≤ UI

–î–∞, —ç—Ç–æ —Ç–µ–∫—É—â–µ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ PeerDB. –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∑–µ—Ä–∫–∞–ª–∞ —á–µ—Ä–µ–∑ UI (`localhost:3000/mirrors`) —Å–∏—Å—Ç–µ–º–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—É—é –æ—á–∏—Å—Ç–∫—É, –≤–∫–ª—é—á–∞—è —É–¥–∞–ª–µ–Ω–∏–µ —Å–ª—É–∂–µ–±–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –≤ —Ü–µ–ª–µ–≤–æ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ ClickHouse), –æ —á–µ–º –∏ —Å–æ–æ–±—â–∞–µ—Ç –ª–æ–≥ `Cleaned up destination peer replication objects`.

–ü—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∫–æ–º–∞–Ω–¥—ã `DROP MIRROR` –≤ `psql` —Ç–∞–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Å–ª—É–∂–µ–±–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ **–Ω–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è**. –í –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ —è–≤–Ω–æ —É–∫–∞–∑–∞–Ω–æ, —á—Ç–æ —ç—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –∏ —É–¥–∞–ª—è–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é, –Ω–æ –Ω–µ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Ü–µ–ª–µ–≤–æ–º –ø–∏—Ä–µ. –ü—Ä—è–º–æ–≥–æ —Å–ø–æ—Å–æ–±–∞ —Å–¥–µ–ª–∞—Ç—å —ç—Ç–æ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ, –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ UI, –≤ —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏, —Å—É–¥—è –ø–æ –≤—Å–µ–º—É, –Ω–µ—Ç.

### üîÑ –ö–∞–∫ –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–∏—Ç—å –∑–µ—Ä–∫–∞–ª–æ –∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –µ–≥–æ

–ß—Ç–æ–±—ã —É–¥–∞–ª–∏—Ç—å –∑–µ—Ä–∫–∞–ª–æ –∏ —Å—Ä–∞–∑—É –∂–µ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –µ–≥–æ —Å —Ç–µ–º–∏ –∂–µ –∏–º–µ–Ω–∞–º–∏ —Å–ª–æ—Ç–∞ –∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏, –Ω—É–∂–Ω–æ –æ–±–æ–π—Ç–∏ –æ–±–µ –ø—Ä–æ–±–ª–µ–º—ã. –í–æ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏–π.

#### 1. –£–¥–∞–ª–µ–Ω–∏–µ –∑–µ—Ä–∫–∞–ª–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ª–æ—Ç–æ–º —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏

1.  **–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –≤ PostgreSQL.** –ù–∞–π–¥–∏—Ç–µ PID –∑–∞–≤–∏—Å—à–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ —Å –ø–æ–º–æ—â—å—é –∑–∞–ø—Ä–æ—Å–∞ –∏ –∑–∞–≤–µ—Ä—à–∏—Ç–µ –µ–≥–æ:
    ```sql
    -- –ù–∞–π—Ç–∏ PID –ø—Ä–æ—Ü–µ—Å—Å–∞, –∏—Å–ø–æ–ª—å–∑—É—é—â–µ–≥–æ –≤–∞—à —Å–ª–æ—Ç
    SELECT pid, usename, application_name, state 
    FROM pg_stat_replication 
    WHERE application_name LIKE '%peerdb%';
    
    -- –ó–∞–≤–µ—Ä—à–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å (–ø–æ–¥—Å—Ç–∞–≤—å—Ç–µ –Ω–∞–π–¥–µ–Ω–Ω—ã–π PID)
    SELECT pg_terminate_backend(2507633);
    ```
2.  **–£–¥–∞–ª–∏—Ç–µ —Å–ª–æ—Ç —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏.** –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞ —Å–ª–æ—Ç –º–æ–∂–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ —É–¥–∞–ª–∏—Ç—å:
    ```sql
    SELECT pg_drop_replication_slot('cs_28826_pdemo');
    ```
3.  **–£–¥–∞–ª–∏—Ç–µ –∑–µ—Ä–∫–∞–ª–æ –≤ PeerDB.** –¢–µ–ø–µ—Ä—å –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É –≤ PeerDB:
    ```sql
    DROP MIRROR cs_28826_to_pdemo;
    ```
4.  **–í—Ä—É—á–Ω—É—é —É–¥–∞–ª–∏—Ç–µ —Å–ª—É–∂–µ–±–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã –≤ ClickHouse.** –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ ClickHouse –∏ —É–¥–∞–ª–∏—Ç–µ —Ç–∞–±–ª–∏—Ü—ã, –∫–æ—Ç–æ—Ä—ã–µ PeerDB —Å–æ–∑–¥–∞–ª –¥–ª—è —ç—Ç–æ–≥–æ –∑–µ—Ä–∫–∞–ª–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `dbo_calls` –∏, –≤–æ–∑–º–æ–∂–Ω–æ, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –Ω–µ–π —Å–ª—É–∂–µ–±–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã).

#### 2. –°–æ–∑–¥–∞–Ω–∏–µ –∑–µ—Ä–∫–∞–ª–∞ –±–µ–∑ –Ω–∞—á–∞–ª—å–Ω–æ–π –≤—ã–≥—Ä—É–∑–∫–∏

–ü–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏ –º–æ–∂–Ω–æ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –∑–µ—Ä–∫–∞–ª–æ. –ö–ª—é—á–µ–≤–æ–π –º–æ–º–µ–Ω—Ç: —á—Ç–æ–±—ã PeerDB –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Å–ª–æ—Ç, –∞ –Ω–µ –ø—ã—Ç–∞–ª—Å—è —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –¥–ª—è –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `do_initial_copy` –∑–Ω–∞—á–µ–Ω–∏–µ `false`.

```sql
CREATE MIRROR cs_28826_to_pdemo
FROM cs_28826_local TO demostand_pdemo
WITH TABLE MAPPING
(
  dbo.calls:dbo_calls
)
WITH (
    do_initial_copy = false, -- –ö–ª—é—á–µ–≤–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä!
    refresh_interval = '15s',
    publication_name = 'demostand_pdemo',
    replication_slot_name = 'cs_28826_pdemo'
);
```

–≠—Ç–æ—Ç –º–µ—Ç–æ–¥ –ø–æ–∑–≤–æ–ª—è–µ—Ç PeerDB –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é —Å –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø–æ–∑–∏—Ü–∏–∏ –≤ —Å–ª–æ—Ç–µ, –∏–∑–±–µ–≥–∞—è –ø–æ–ª–Ω–æ–π –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö.
